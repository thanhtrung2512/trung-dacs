<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kho√° h·ªçc | LMS Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== 1. BI·∫æN M√ÄU S·∫ÆC ===== */
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #0ea5e9;
            --accent: #f59e0b;
            --bg: #f8fafc;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --card-bg: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Be Vietnam Pro', sans-serif; background: var(--bg); color: var(--text-main); line-height: 1.6; }

        /* ===== 2. HEADER ===== */
        header {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0; padding: 15px 50px;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
        }
        header .logo { font-size: 20px; font-weight: 800; color: var(--primary); text-decoration: none; }
        .nav-link { color: var(--text-sub); text-decoration: none; font-weight: 600; font-size: 14px; margin-left: 20px; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { color: var(--primary); }

        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }

        /* ===== 3. HERO & SEARCH ===== */
        .hero-section { text-align: center; margin-bottom: 40px; }
        .hero-title { font-size: 36px; font-weight: 800; margin-bottom: 10px; color: var(--text-main); }
        .hero-subtitle { color: var(--text-sub); margin-bottom: 30px; font-size: 16px; }

        .search-wrapper { position: relative; max-width: 600px; margin: 0 auto 30px auto; }
        .search-input {
            width: 100%; padding: 18px 25px; padding-left: 55px;
            border: 2px solid transparent; border-radius: 50px;
            background: white; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.08);
            font-size: 16px; outline: none; transition: 0.3s;
        }
        .search-input:focus { border-color: var(--primary); box-shadow: 0 10px 40px -5px rgba(79, 70, 229, 0.2); }
        .search-icon { position: absolute; left: 22px; top: 50%; transform: translateY(-50%); color: #94a3b8; font-size: 18px; }

        /* ===== 4. FILTER BAR ===== */
        .filter-container { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 50px; }
        .filter-btn {
            background: white; border: 1px solid #e2e8f0; padding: 10px 24px;
            border-radius: 30px; font-size: 14px; font-weight: 600; color: var(--text-sub);
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 8px;
        }
        .filter-btn:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-2px); }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }

        /* ===== 5. RECOMMENDATION SECTION (UPDATED CSS) ===== */
        .rec-section { margin-bottom: 60px; }
        .section-header { display: flex; align-items: center; margin-bottom: 25px; gap: 10px; }
        .section-title { font-size: 20px; font-weight: 800; margin: 0; }
        
        .rec-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .rec-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border: 1px solid #e2e8f0; border-radius: 20px; padding: 25px;
            position: relative; overflow: hidden; transition: 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03); display: flex; flex-direction: column;
        }
        .rec-card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 15px 30px rgba(79, 70, 229, 0.15); }
        
        /* CSS cho Badge th√¥ng minh */
        .rec-badge {
            position: absolute; top: 15px; right: 15px; 
            font-size: 10px; font-weight: 800; padding: 6px 12px; border-radius: 8px;
            display: flex; align-items: center; gap: 5px;
        }

        /* ===== 6. SUBJECT GRID ===== */
        .subject-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        
        .subject-card {
            background: white; border-radius: 20px; padding: 0;
            text-decoration: none; color: inherit; transition: 0.3s;
            border: 1px solid #f1f5f9; display: flex; flex-direction: column;
            position: relative; overflow: hidden; height: 100%;
        }
        .subject-card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 20px 40px -10px rgba(79, 70, 229, 0.15); }

        .card-top { padding: 25px 25px 15px 25px; flex-grow: 1; display: flex; flex-direction: column; }
        
        .badges-row { display: flex; gap: 8px; margin-bottom: 15px; }
        .badge { font-size: 11px; font-weight: 700; padding: 4px 10px; border-radius: 6px; }
        .badge-code { background: #eef2ff; color: var(--primary); }
        .badge-major { background: #f1f5f9; color: #64748b; }

        .subject-name { font-size: 18px; font-weight: 700; margin-bottom: 10px; color: var(--text-main); line-height: 1.4; }
        .subject-desc { font-size: 14px; color: var(--text-sub); line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        .card-bottom {
            padding: 15px 25px; border-top: 1px solid #f8fafc; background: #fcfcfc;
            display: flex; justify-content: space-between; align-items: center;
        }
        .meta-info { font-size: 12px; font-weight: 600; color: #94a3b8; }
        .btn-arrow { color: var(--primary); transition: 0.3s; }
        .subject-card:hover .btn-arrow { transform: translateX(5px); }

        .hidden { display: none !important; }
        .no-result { 
            grid-column: 1 / -1; text-align: center; padding: 60px; 
            background: white; border-radius: 20px; border: 2px dashed #e2e8f0; display: none;
        }
    </style>
</head>
<body>

<header>
    <a href="/student/dashboard" class="logo">‚ö° LMS Pro</a>
    <div>
        <a href="/student/dashboard" class="nav-link">Dashboard</a>
        <a href="/student/subjects" class="nav-link active">Kho√° h·ªçc</a>
        <a href="/student/history" class="nav-link">L·ªãch s·ª≠</a>
        <a href="/logout" class="nav-link" style="color: #ef4444;">ƒêƒÉng xu·∫•t</a>
    </div>
</header>

<div class="container">

    <div class="hero-section">
        <div class="hero-title">Th∆∞ vi·ªán tri th·ª©c</div>
        <div class="hero-subtitle">Kh√°m ph√° l·ªô tr√¨nh h·ªçc t·∫≠p ƒë∆∞·ª£c thi·∫øt k·∫ø ri√™ng cho b·∫°n</div>
        
        <div class="search-wrapper">
            <span class="search-icon"><i class="fas fa-search"></i></span>
            <input type="text" id="searchInput" class="search-input" 
                   placeholder="T√¨m ki·∫øm m√¥n h·ªçc (V√≠ d·ª•: Java, Python, Kinh t·∫ø)..." 
                   autocomplete="off" onkeyup="applyFilters()" th:value="${keyword}">
        </div>

        <div class="filter-container">
            <div class="filter-btn active" onclick="filterByMajor('all', this)">
                <i class="fas fa-layer-group"></i> T·∫•t c·∫£
            </div>
            <div class="filter-btn" onclick="filterByMajor('CNTT', this)">
                <i class="fas fa-laptop-code"></i> C√¥ng ngh·ªá th√¥ng tin
            </div>
            <div class="filter-btn" onclick="filterByMajor('Kinh t·∫ø', this)">
                <i class="fas fa-chart-line"></i> Kinh t·∫ø
            </div>
            <div class="filter-btn" onclick="filterByMajor('Ng√¥n ng·ªØ', this)">
                <i class="fas fa-language"></i> Ng√¥n ng·ªØ
            </div>
             <div class="filter-btn" onclick="filterByMajor('Kh√°c', this)">
                <i class="fas fa-shapes"></i> Kh√°c
            </div>
        </div>
    </div>

    <div th:if="${!recommendations.isEmpty()}" class="rec-section">
        <div class="section-header">
            <i class="fas fa-route" style="color: var(--accent); font-size: 24px;"></i>
            <h3 class="section-title">L·ªô tr√¨nh h·ªçc t·∫≠p ƒë·ªÅ xu·∫•t</h3>
        </div>
        
        <div class="rec-grid">
            <div th:each="subject : ${recommendations}" class="rec-card">
                
                <div class="rec-badge" 
                     th:if="${subject.targetMajor == student.major}" 
                     th:style="${subject.semester == 1 ? 'background: #dcfce7; color: #166534; border: 1px solid #bbf7d0;' : 'background: #eff6ff; color: #2563eb; border: 1px solid #bfdbfe;'}">
                     <i class="fas fa-layer-group"></i>
                     <span th:text="${subject.semester == 1 ? 'KI·∫æN TH·ª®C N·ªÄN T·∫¢NG' : 'CHUY√äN S√ÇU - K·ª≤ ' + subject.semester}"></span>
                </div>

                <div class="rec-badge" 
                     th:if="${subject.targetMajor != student.major}"
                     style="background: #fffbeb; color: #b45309; border: 1px solid #fcd34d;">
                     <i class="fas fa-fire"></i> M·ªû R·ªòNG K·ª∏ NƒÇNG
                </div>
                
                <div style="font-size: 11px; font-weight: 700; color: var(--text-sub); margin-bottom: 5px; text-transform: uppercase;">
                    <i class="fas fa-graduation-cap"></i> <span th:text="${subject.targetMajor}">Major</span>
                </div>
                
                <h4 style="font-size: 18px; font-weight: 800; margin-bottom: 8px;" th:text="${subject.name}">T√™n m√¥n</h4>
                
                <p style="font-size: 13px; color: var(--text-sub); margin-bottom: 15px; line-height: 1.5; flex-grow: 1; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;"
                   th:text="${subject.description}">M√¥ t·∫£...</p>
                   
                <div style="display: flex; gap: 15px; font-size: 12px; color: #64748b; margin-bottom: 15px;">
                    <span><i class="fas fa-coins"></i> <b th:text="${subject.credit}">3</b> T√≠n ch·ªâ</span>
                    <span th:if="${subject.targetMajor == student.major}">
                        <i class="fas fa-book-reader"></i> K·ª≥ <b th:text="${subject.semester}">1</b>
                    </span>
                </div>
                
                <a th:href="@{'/student/subjects/' + ${subject.id}}" 
                   style="text-decoration: none; background: var(--primary); color: white; padding: 10px; border-radius: 8px; font-weight: 600; text-align: center; transition: 0.2s; box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2);">
                    Xem chi ti·∫øt <i class="fas fa-arrow-right" style="font-size: 10px; margin-left: 5px;"></i>
                </a>
            </div>
        </div>
    </div>
    <div class="section-header">
        <i class="fas fa-th-large" style="color: var(--primary); font-size: 24px;"></i>
        <h3 class="section-title">T·∫•t c·∫£ m√¥n h·ªçc</h3>
    </div>
    
    <div class="subject-grid" id="subjectGrid">
        <a th:each="subject : ${subjects}" 
           th:href="@{/student/subjects/{id}(id=${subject.id})}" 
           class="subject-card"
           th:data-name="${subject.name.toLowerCase()}"
           th:data-major="${subject.targetMajor != null ? subject.targetMajor : 'Kh√°c'}"> 
            
            <div class="card-top">
                <div class="badges-row">
                    <span class="badge badge-code" th:text="${subject.subjectCode}">CODE</span>
                    <span class="badge badge-major" th:text="${subject.targetMajor != null ? subject.targetMajor : 'Chung'}">Ng√†nh</span>
                </div>
                
                <div class="subject-name" th:text="${subject.name}">T√™n m√¥n h·ªçc</div>
                <p class="subject-desc" th:text="${subject.description}">M√¥ t·∫£ ng·∫Øn...</p>
            </div>

            <div class="card-bottom">
                <div class="meta-info">
                    <i class="fas fa-layer-group"></i> <span th:text="${subject.credit}">3</span> T√≠n ch·ªâ
                </div>
                <div class="btn-arrow"><i class="fas fa-arrow-right"></i></div>
            </div>
        </a>
    </div>

    <div id="noResultMsg" class="no-result">
        <div style="font-size: 40px; margin-bottom: 10px;">üòï</div>
        <strong style="font-size: 18px; display: block; margin-bottom: 5px;">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o</strong>
        <span style="color: var(--text-sub);">H√£y th·ª≠ thay ƒë·ªïi t·ª´ kh√≥a ho·∫∑c b·ªô l·ªçc ng√†nh h·ªçc.</span>
    </div>

</div>

<script>
    let currentCategory = 'all';

    function filterByMajor(category, btnElement) {
        currentCategory = category;
        const buttons = document.getElementsByClassName('filter-btn');
        for (let btn of buttons) {
            btn.classList.remove('active');
        }
        btnElement.classList.add('active');
        applyFilters();
    }

    function applyFilters() {
        const input = document.getElementById('searchInput');
        const keyword = input.value.toLowerCase().trim();
        const cards = document.getElementsByClassName('subject-card');
        const noResult = document.getElementById('noResultMsg');
        let hasMatch = false;

        for (let i = 0; i < cards.length; i++) {
            const card = cards[i];
            const subjectName = card.getAttribute('data-name');
            const subjectMajor = (card.getAttribute('data-major') || '').toLowerCase(); 

            const matchKeyword = subjectName.includes(keyword);
            
            let matchCategory = false;
            if (currentCategory === 'all') {
                matchCategory = true;
            } else {
                if (currentCategory === 'CNTT') {
                    matchCategory = subjectMajor.includes('c√¥ng ngh·ªá') || subjectMajor.includes('cntt') || subjectMajor.includes('tin');
                } else if (currentCategory === 'Kinh t·∫ø') {
                    matchCategory = subjectMajor.includes('kinh t·∫ø') || subjectMajor.includes('marketing');
                } else if (currentCategory === 'Ng√¥n ng·ªØ') {
                    matchCategory = subjectMajor.includes('ti·∫øng') || subjectMajor.includes('ng√¥n ng·ªØ');
                } else {
                    matchCategory = true; 
                }
            }

            if (matchKeyword && matchCategory) {
                card.classList.remove('hidden');
                hasMatch = true;
            } else {
                card.classList.add('hidden');
            }
        }

        if (hasMatch) {
            noResult.style.display = 'none';
        } else {
            noResult.style.display = 'block';
        }
    }
</script>

</body>
</html>